package fun.kubik.modules.player;

import fun.kubik.events.api.EventHook;
import fun.kubik.events.main.EventUpdate;
import fun.kubik.events.main.input.EventInput;
import fun.kubik.managers.module.Module;
import fun.kubik.managers.module.main.Category;
import fun.kubik.managers.module.option.main.BindOption;
import net.minecraft.client.Minecraft;
import net.minecraft.inventory.container.ClickType;
import net.minecraft.inventory.container.Container;
import net.minecraft.item.ItemStack;

public class EnderChestExploit extends Module {
    private final BindOption saveKey = new BindOption("Кнопка сейва", -1);
    private boolean check = false;
    private boolean fakeClosed = false;
    private final Minecraft mc = Minecraft.getInstance();

    public EnderChestExploit() {
        super("EnderChestExploit", Category.PLAYER);
        this.settings(this.saveKey);
    }

    @EventHook
    public void key(EventInput event) {
        if (event.getKey() == this.saveKey.getKey()) {
            check = true;
        }
    }

    @EventHook
    public void update(EventUpdate event) {
        Container handler = mc.player.openContainer;
        if (handler != null && handler.inventorySlots.size() >= 27 && handler.getInventory().size() <= 63) {
            int chestSlots = handler.inventorySlots.size() - 36;
            if (chestSlots == 27) {
                if (!fakeClosed && mc.currentScreen != null) {
                    mc.displayGuiScreen(null);
                    mc.mouseHelper.grabMouse();
                    fakeClosed = true;
                }
                if (check) {
                    check = false;
                    fakeClosed = false;
                    for (int i = chestSlots; i < handler.inventorySlots.size(); i++) {
                        ItemStack stack = handler.getSlot(i).getStack();
                        if (!stack.isEmpty()) {
                            mc.playerController.windowClick(handler.windowId, i, 0, ClickType.QUICK_MOVE, mc.player);
                        }
                    }
                }
            }
        } else {
            fakeClosed = false;
        }
    }

    @Override
    public void onDisabled() {
        check = false;
        fakeClosed = false;
    }
}